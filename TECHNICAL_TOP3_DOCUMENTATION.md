# UPH 异常差异数据 TOP3 同步系统技术文档

## 1. 项目概述

### 1.1 项目目标
在现有 UPH 分析系统基础上，扩展实现异常差异数据 TOP3 自动同步到总异常表 `alarm_info` 的功能，并提供手动触发界面，用于监控和分析生产过程中的异常差异情况。本项目强调与现有系统的充分融合，避免形成独立的前后端服务。

### 1.2 核心功能
- **定时同步**：每日凌晨 02:00:00 自动执行数据同步
- **数据筛选**：筛选 `lineName` 以 "A" 开头的数据
- **差异统计**：按 `data_source`（cs/sz）分别统计差异最大的前三行数据
- **数据映射**：将原始数据映射到 `alarm_info` 表的对应字段
- **手动触发**：在现有分析页面添加【TOP3推送】按钮，支持手动触发同步
- **状态提示**：提供推送中、推送成功、推送失败等状态提示
- **重复检测**：防止当天重复推送数据

### 1.3 技术栈（与现有系统保持一致）
- **前端**：React + TypeScript + Zustand（复用现有状态管理）
- **后端**：Node.js + Express + MySQL（复用现有数据库连接）
- **定时任务**：Node.js 定时器（集成到现有后端服务）
- **数据库**：MySQL 5.7+（复用现有数据库）

## 2. 系统架构图

### 2.1 现有系统架构

现有 UPH 分析系统采用前后端分离架构，前端使用 React + TypeScript + Zustand 进行状态管理，后端使用 Node.js + Express + MySQL。系统主要功能包括数据查询、分析展示、详情编辑等。

### 2.2 TOP3推送功能集成架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                               前端应用                                  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                            分析页面                               │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                      原有数据展示组件                        │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                  新增：TOP3推送按钮组件                      │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                 新增：推送状态提示组件                       │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                          详情模态框                         │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          现有状态管理                           │  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                       原有数据状态                          │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                新增：TOP3推送状态管理                       │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          现有API客户端                           │  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                      原有API方法                            │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                   新增：TOP3推送API方法                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                               后端服务                                  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                           路由层 (Routes)                          │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                        原有路由配置                          │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │          新增：TOP3推送路由 (集成到现有路由系统)             │  │  │
│  │  │  - POST /api/top3/push          - 手动触发TOP3推送           │  │  │
│  │  │  - GET /api/top3/status         - 查询推送状态               │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                         控制器层 (Controllers)                     │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                        原有控制器                            │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │             新增：TOP3推送控制器 (top3Controller)           │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                         服务层 (Services)                         │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                        原有服务层                            │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │              新增：TOP3推送服务 (top3Service)                │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          现有服务器入口                           │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                       原有服务启动逻辑                        │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │             新增：定时任务初始化 (集成到现有服务)             │  │  │
│  │  │       - 每日凌晨2点执行TOP3推送任务                          │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                               数据库层                                  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          原有数据表                               │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                      uph_analys表                           │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                      uph_item表                             │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          新增数据表                               │  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                      alarm_info表                           │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.3 集成要点

1. **前端集成**：
   - 在现有 `AnalysesPage.tsx` 中新增 TOP3 推送按钮组件
   - 扩展现有 `analysesApi` 客户端，添加 TOP3 推送相关 API 方法
   - 在现有状态管理中扩展 TOP3 推送状态
   - 复用现有 UI 组件和样式，保持一致的用户体验

2. **后端集成**：
   - 扩展现有路由系统，添加 TOP3 推送相关路由
   - 新增 TOP3 推送控制器和服务，复用现有数据库连接
   - 在现有服务器入口中初始化定时任务
   - 复用现有错误处理和日志记录机制

3. **数据库集成**：
   - 新增 `alarm_info` 表（如不存在）
   - 复用现有 `uph_analys` 表作为数据源
   - 确保新增表与现有表使用相同的数据库连接和权限

4. **部署集成**：
   - 复用现有部署脚本和配置
   - 无需新增服务器或容器
   - 新增功能随现有系统一起部署和更新

5. **监控集成**：
   - 复用现有监控系统
   - 扩展现有日志记录，添加 TOP3 推送相关日志
   - 新增监控指标时，集成到现有监控面板

## 3. 前后端目录结构

### 3.1 后端目录结构（与现有系统融合）
```
backend/
├── src/
│   ├── controllers/          # 控制器层
│   │   ├── itemsController.ts      # 原有items控制器
│   │   └── top3Controller.ts       # 新增：TOP3推送控制器
│   ├── services/            # 服务层
│   │   ├── itemsService.ts         # 原有items服务
│   │   └── top3Service.ts          # 新增：TOP3推送服务
│   ├── models/              # 数据模型层
│   │   ├── types.ts                # 原有类型定义（需扩展）
│   │   └── alarmInfoModel.ts       # 新增：alarm_info表模型
│   ├── routes/              # 路由层
│   │   ├── itemsRoutes.ts          # 原有items路由
│   │   └── top3Routes.ts           # 新增：TOP3推送路由
│   ├── utils/               # 工具函数
│   │   ├── db.ts                   # 原有数据库连接（复用）
│   │   └── scheduler.ts            # 新增：定时任务调度
│   └── server.ts            # 服务器入口（需修改：初始化定时任务）
├── package.json             # 原有配置（需更新：添加依赖）
└── tsconfig.json            # 原有配置（无需修改）
```

### 3.2 前端目录结构（与现有系统融合）
```
frontend/
├── src/
│   ├── components/          # 组件层
│   │   ├── Table.tsx               # 原有数据表格组件
│   │   ├── DetailModal.tsx         # 原有详情模态框
│   │   └── Top3PushButton.tsx      # 新增：TOP3推送按钮组件
│   ├── pages/               # 页面层
│   │   ├── AnalysesPage.tsx        # 原有分析页面（需修改：添加TOP3推送按钮）
│   │   └── DetailPage.tsx          # 原有详情页面
│   ├── stores/              # 状态管理
│   │   ├── analysesStore.ts        # 原有分析数据状态（需扩展：添加TOP3推送状态）
│   │   └── top3Store.ts            # 新增：TOP3推送状态管理（或集成到analysesStore）
│   ├── utils/               # 工具函数
│   │   ├── axios.ts                # 原有API请求封装（需扩展：添加TOP3推送API）
│   │   └── format.ts               # 原有数据格式化
│   ├── types/               # 类型定义
│   │   └── api.ts                  # 原有API类型定义（需扩展：添加TOP3推送相关类型）
│   └── App.tsx              # 应用入口（无需修改）
├── package.json             # 原有配置（无需修改）
└── tsconfig.json            # 原有配置（无需修改）
```

### 3.3 集成说明

1. **最小化修改原则**：
   - 仅修改必要的现有文件，新增文件采用模块化设计
   - 避免大规模重构现有代码，降低引入新问题的风险
   - 保持原有代码结构和命名规范

2. **类型定义扩展**：
   - 在现有 `types.ts` 和 `api.ts` 中扩展TOP3推送相关类型
   - 避免创建新的类型文件，保持类型定义的集中管理

3. **状态管理集成选项**：
   - **选项1**：新增独立的 `top3Store.ts`（适合复杂功能）
   - **选项2**：扩展现有 `analysesStore.ts`（适合简单功能，推荐）
   - 推荐选择选项2，减少状态管理的复杂度

4. **路由集成**：
   - 新增的 `top3Routes.ts` 需在现有路由系统中注册
   - 推荐在 `server.ts` 或 `app.ts` 中统一注册所有路由

5. **API客户端扩展**：
   - 在现有 `analysesApi` 中扩展TOP3推送相关API方法
   - 保持API客户端的一致性，便于维护和使用

6. **定时任务集成**：
   - 在现有 `server.ts` 中初始化定时任务
   - 推荐使用 `node-cron` 或类似库管理定时任务
   - 确保定时任务在服务器启动时正确初始化

7. **依赖管理**：
   - 新增依赖：`node-cron`（定时任务）
   - 无需新增其他重大依赖，充分利用现有依赖

8. **代码组织**：
   - 新增文件采用清晰的命名规范，便于识别和维护
   - 新增功能模块与现有模块保持一致的代码风格
   - 编写完整的注释，说明新增功能的用途和使用方法

## 4. 核心数据结构

### 4.1 源数据表结构 (uph_analys)

| 字段名 | 类型 | 描述 |
|--------|------|------|
| serial_number | INT | 计划ID |
| lineName | VARCHAR(255) | 线别 |
| model_type | VARCHAR(255) | 机型 |
| lineModel | VARCHAR(255) | 设备类型 |
| data_source | VARCHAR(10) | 数据源 (cs/sz) |
| diff_cnt_8_10 | INT | 8-10点差异计数 |
| diff_cnt_10_12 | INT | 10-12点差异计数 |
| diff_cnt_12_14 | INT | 12-14点差异计数 |
| diff_cnt_14_16 | INT | 14-16点差异计数 |
| diff_cnt_16_18 | INT | 16-18点差异计数 |
| diff_cnt_18_20 | INT | 18-20点差异计数 |
| diff_cnt_20_22 | INT | 20-22点差异计数 |
| diff_cnt_22_24 | INT | 22-24点差异计数 |
| diff_cnt_24_2 | INT | 0-2点差异计数 |
| diff_cnt_2_4 | INT | 2-4点差异计数 |
| diff_cnt_4_6 | INT | 4-6点差异计数 |
| diff_cnt_6_8 | INT | 6-8点差异计数 |
| diffDay | INT | 白班差异合计 |
| diffNight | INT | 晚班差异合计 |
| diffTotal | INT | 差异总计 |

### 4.2 目标数据表结构 (alarm_info)

| 字段名 | 类型 | 描述 |
|--------|------|------|
| pc_number | VARCHAR(255) | 设备编号 |
| model | VARCHAR(255) | 机型 |
| location | VARCHAR(255) | 位置 |
| alarm_message | VARCHAR(255) | 告警信息 |
| updated_at | DATETIME | 更新时间 |
| alarm_level | VARCHAR(255) | 告警级别 |

### 4.3 数据映射关系

| 源数据 (uph_analys + 计算) | 目标数据 (alarm_info) | 转换规则 |
|---------------------------|-----------------------|----------|
| data_source | pc_number | cs → HNZ, sz → ZLT |
| model_type | model | 直接映射 |
| lineName | location | 直接映射 |
| diffTotal (差异总计) | alarm_message | 直接映射（显示为"合计列差异数据"） |
| 同步时间 | updated_at | 当前时间 |
| 固定值 | alarm_level | 固定为"UPH_TOP3差异推送" |

### 4.4 核心业务对象类型定义

```typescript
// 后端类型定义
interface Top3DataItem {
  serial_number: number;
  lineName: string;
  model_type: string;
  lineModel: string;
  data_source: string;
  diffTotal: number;
}

interface AlarmInfoItem {
  pc_number: string;
  model: string;
  location: string;
  alarm_message: string;
  updated_at: Date;
  alarm_level: string;
}

// 前端类型定义
interface Top3PushStatus {
  success: boolean;
  message: string;
  lastPushTime?: string;
}

interface Top3PushResponse {
  success: boolean;
  message: string;
  data?: any;
}
```

## 5. API 设计

### 5.1 后端API设计（与现有系统融合）

#### 5.1.1 API 路由设计

| API路径 | 方法 | 功能描述 | 请求参数 | 响应结果 | 集成方式 |
|---------|------|----------|----------|----------|----------|
| `/api/top3/push` | POST | 手动触发TOP3数据推送 | 无 | `{ success: boolean, message: string }` | 新增路由，集成到现有路由系统 |
| `/api/top3/status` | GET | 查询TOP3推送状态 | 无 | `{ success: boolean, message: string, lastPushTime?: string }` | 新增路由，集成到现有路由系统 |

#### 5.1.2 路由注册（与现有系统融合）

```typescript
// server.ts - 现有服务器入口（需修改）
import express from 'express';
import itemsRoutes from './routes/itemsRoutes';
import top3Routes from './routes/top3Routes'; // 新增
import { setupScheduledTasks } from './utils/scheduler'; // 新增

const app = express();

// 现有中间件配置
app.use(express.json());

// 路由注册
app.use('/api/items', itemsRoutes); // 现有路由
app.use('/api/top3', top3Routes); // 新增路由

// 初始化定时任务（新增）
setupScheduledTasks();

const PORT = process.env.PORT || 6000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

#### 5.1.3 控制器实现（与现有系统融合）

```typescript
// top3Controller.ts - 新增控制器
import { Request, Response, NextFunction } from 'express';
import { top3Service } from '../services/top3Service';
import { logger } from '../utils/logger'; // 复用现有日志工具

export const pushTop3Data = async (req: Request, res: Response, next: NextFunction) => {
  try {
    logger.info('Received TOP3 push request'); // 复用现有日志
    const result = await top3Service.pushTop3Data();
    logger.info('TOP3 push completed successfully');
    res.json(result);
  } catch (error) {
    logger.error('TOP3 push failed:', error); // 复用现有日志
    next(error);
  }
};

export const getPushStatus = async (req: Request, res: Response, next: NextFunction) => {
  try {
    const status = await top3Service.getPushStatus();
    res.json(status);
  } catch (error) {
    logger.error('Failed to get TOP3 status:', error); // 复用现有日志
    next(error);
  }
};
```

### 5.2 前端API调用（与现有系统融合）

#### 5.2.1 API客户端扩展（复用现有客户端）

```typescript
// axios.ts - 现有API客户端（需修改）
import axios from 'axios';
import { AnalysesListRes, AnalysesDetailRes, UphItem, PatchBody } from '@/types/api';

// 扩展类型定义（与现有类型融合）
interface Top3PushStatus {
  success: boolean;
  message: string;
  lastPushTime?: string;
}

interface Top3PushResponse {
  success: boolean;
  message: string;
  data?: any;
}

export const api = axios.create({
  baseURL: '/api',
  timeout: 10000
});

export const analysesApi = {
  // 原有API方法...
  list: (params?: Record<string, any>) => api.get<AnalysesListRes>('/analyses', { params }),
  detail: (serial: number) => api.get<AnalysesDetailRes>(`/analyses/${serial}`),
  sync: (params?: Record<string, any>) => api.post('/analyses/sync', null, { params: { ...(params || {}), async: true }, timeout: 10000 }),
  syncStatus: () => api.get('/analyses/sync/status'),
  maxDates: () => api.get('/analyses/max-dates'),
  bucket: (serial: number, slot: string, source?: 'cs'|'sz') => api.get(`/analyses/${serial}/bucket`, { params: { slot, source } }),
  pqtyZero: (ids: number[], source: 'cs'|'sz') => api.get('/analyses/pqty-zero', { params: { ids: ids.join(','), source } }),
  // 新增TOP3推送API方法
  top3Push: () => api.post<Top3PushResponse>('/top3/push'),
  top3Status: () => api.get<Top3PushStatus>('/top3/status')
};
```

#### 5.2.2 状态管理集成（推荐集成到现有store）

```typescript
// analysesStore.ts - 现有分析数据状态（推荐扩展，替代独立的top3Store）
import { create } from 'zustand';
import { analysesApi } from '@/utils/axios';
import { AnalysesListRes, UphAnalys } from '@/types/api';

interface State {
  // 原有状态...
  list: UphAnalys[];
  page: number;
  size: number;
  total: number;
  loading: boolean;
  error: string | null;
  filters: any;
  sort_by: string;
  sort_dir: 'asc' | 'desc';
  diffTotal: number;
  diffDay: number;
  diffNight: number;
  // 新增TOP3推送状态
  top3Status: { success?: boolean; message?: string; lastPushTime?: string } | null;
  top3Loading: boolean;
}

interface Actions {
  // 原有操作...
  fetchList: () => Promise<void>;
  setPage: (page: number) => void;
  setSize: (size: number) => void;
  setFilters: (filters: any) => void;
  setSort: (col: string) => void;
  // 新增TOP3推送操作
  pushTop3: () => Promise<void>;
  getTop3Status: () => Promise<void>;
}

export const useAnalysesStore = create<State & Actions>((set) => ({
  // 原有状态初始化...
  list: [],
  page: 1,
  size: 20,
  total: 0,
  loading: false,
  error: null,
  filters: {},
  sort_by: 'serial_number',
  sort_dir: 'desc',
  diffTotal: 0,
  diffDay: 0,
  diffNight: 0,
  // 新增TOP3状态初始化
  top3Status: null,
  top3Loading: false,

  // 原有操作实现...
  fetchList: async () => {
    // 原有实现...
  },
  // 其他原有操作...

  // 新增TOP3推送操作
  pushTop3: async () => {
    set({ top3Loading: true });
    try {
      const { data } = await analysesApi.top3Push();
      set({ top3Status: data, top3Loading: false });
    } catch (error: any) {
      set({ top3Status: { success: false, message: error.message }, top3Loading: false });
    }
  },
  getTop3Status: async () => {
    try {
      const { data } = await analysesApi.top3Status();
      set({ top3Status: data });
    } catch (error: any) {
      console.error('Failed to get top3 status:', error);
      set({ top3Status: { success: false, message: error.message } });
    }
  }
}));
```

#### 5.2.3 前端组件集成（与现有系统融合）

```typescript
// AnalysesPage.tsx - 现有分析页面（需修改）
import { useEffect } from 'react';
import { useAnalysesStore } from '@/stores/analysesStore';
import SourceToggle from '@/components/SourceToggle';
import LinePrefixToggle from '@/components/LinePrefixToggle';
import SearchForm from '@/components/SearchForm';
import Table from '@/components/Table';
import Pagination from '@/components/Pagination';
import Top3PushButton from '@/components/Top3PushButton'; // 新增组件

export default function AnalysesPage() {
  const {
    // 原有状态...
    list, page, size, total, loading, error, fetchList, setPage, setSize, setFilters, filters,
    // 新增TOP3状态和操作
    top3Status, top3Loading, pushTop3, getTop3Status
  } = useAnalysesStore();

  useEffect(() => {
    fetchList();
    getTop3Status(); // 新增：获取TOP3推送状态
  }, [page, filters]);

  // 原有handleSearch等函数...

  return (
    <div>
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-6">
          <h2 className="text-lg font-semibold">UPH 达成列表</h2>
          {/* 原有组件... */}
          <SourceToggle ... />
          <LinePrefixToggle ... />
        </div>
        {/* 新增TOP3推送按钮 */}
        <Top3PushButton 
          loading={top3Loading} 
          status={top3Status} 
          onPush={pushTop3} 
        />
      </div>
      {/* 原有组件... */}
      <SearchForm ... />
      {loading ? (
        <div className="text-gray-500">加载中…</div>
      ) : (
        <>
          <Table data={list} ... />
          <Pagination ... />
        </>
      )}
    </div>
  );
}
```

## 6. 调解流程状态机

### 6.1 定时推送流程（与现有系统融合）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          服务器启动                                    │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       初始化定时任务 (集成到现有服务)                    │
│  - 复用现有服务器入口                                                │
│  - 使用node-cron库设置每日02:00:00执行任务                             │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          定时任务触发 (02:00:00)                         │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        检查当天是否已推送数据                            │
│  - 查询alarm_info表，检查当天是否已有TOP3推送记录                       │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                   查询uph_analys表符合条件的数据                        │
│  - 时间范围：前一日01:00:00 至 当日01:00:00                              │
│  - 筛选条件：lineName LIKE 'A%'                                          │
│  - 分组条件：按data_source (cs/sz)分组                                   │
│  - 复用现有数据库连接                                                   │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                   计算每个分组的差异总计并排序                           │
│  - 计算diffTotal（差异总计）                                             │
│  - 按diffTotal降序排序                                                  │
│  - 取每个分组的前3条数据                                                │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      数据转换与映射                                    │
│  - 将data_source转换为pc_number（cs→HNZ, sz→ZLT）                       │
│  - 映射其他字段到alarm_info表结构                                       │
│  - 设置alarm_level为"UPH_TOP3差异推送"                                  │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      插入数据到alarm_info表                              │
│  - 复用现有数据库连接                                                   │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          记录推送日志                                    │
│  - 复用现有日志系统                                                     │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          推送完成                                      │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.2 手动推送流程（与现有系统融合）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          前端访问现有分析页面                            │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       加载TOP3推送状态 (集成到现有状态)                  │
│  - 复用现有状态管理                                                     │
│  - 页面加载时自动获取推送状态                                           │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          前端点击【TOP3推送】按钮                        │
│  - 按钮集成到现有分析页面                                               │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          调用后端API /api/top3/push                     │
│  - 复用现有API客户端                                                   │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          检查当天是否已推送数据                          │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         │
            ┌───────────────────────────┴───────────────────────────┐
            │                                                       │
            ▼                                                       ▼
┌──────────────────────────┐                          ┌──────────────────────────┐
│  当天已推送              │                          │  当天未推送              │
│  └──────────────────────┐ │                          │  └──────────────────────┐ │
│                         ▼ │                          │                         ▼ │
│  返回提示："当天数据已推送，无需重复推送！"  │                          │  执行TOP3数据推送流程   │
│  - 复用现有响应格式                                               │  └──────────────────────┐ │
└──────────────────────────┘                          │                         ▼ │
                                                       │  返回推送结果           │
                                                       │  - 推送中...           │
                                                       │  - 推送成功！          │
                                                       │  - 推送失败！          │
                                                       │  - 复用现有响应格式     │
                                                       └──────────────────────────┘
```

### 6.3 异常处理流程（与现有系统融合）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          推送过程中发生异常                              │
│  - 定时任务或手动推送过程中                                           │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          捕获异常并记录日志                              │
│  - 复用现有错误处理机制                                               │
│  - 复用现有日志系统，记录详细错误信息                                 │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          生成错误响应                                    │
│  - 复用现有响应格式                                                   │
│  - 返回统一的错误结构                                                 │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          返回错误信息给前端                              │
│  - 手动推送：直接返回给前端                                            │
│  - 定时任务：记录到日志，无需返回                                      │
└───────────────────────────────────────┬─────────────────────────────────┘
                                         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          前端显示错误提示                                │
│  - 复用现有UI组件和样式                                               │
│  - 显示用户友好的错误信息                                             │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.4 集成要点

1. **定时任务集成**：
   - 定时任务初始化集成到现有服务器入口
   - 复用现有数据库连接和日志系统
   - 使用轻量级定时任务库，避免引入复杂依赖

2. **状态管理集成**：
   - 推荐将TOP3推送状态集成到现有状态管理中
   - 减少状态管理的复杂度，便于维护
   - 保持状态更新的一致性

3. **API集成**：
   - 新增API路由集成到现有路由系统
   - 复用现有API客户端和错误处理机制
   - 保持API响应格式的一致性

4. **前端UI集成**：
   - TOP3推送按钮集成到现有分析页面
   - 状态提示组件复用现有UI样式
   - 保持用户体验的一致性

5. **数据库集成**：
   - 复用现有数据库连接
   - 新增alarm_info表，与现有表使用相同的数据库
   - 确保数据库权限一致

6. **日志和监控集成**：
   - 复用现有日志系统，记录TOP3推送相关日志
   - 扩展现有监控指标，添加TOP3推送相关指标
   - 保持日志格式的一致性

7. **错误处理集成**：
   - 复用现有错误处理机制
   - 保持错误响应格式的一致性
   - 提供用户友好的错误信息

8. **部署集成**：
   - 无需新增服务器或容器
   - 复用现有部署脚本和配置
   - 新增功能随现有系统一起部署和更新

### 6.5 代码复用清单

| 组件/模块 | 用途 | 复用方式 |
|-----------|------|----------|
| 数据库连接 | 连接MySQL数据库 | 直接复用现有db.ts |
| 日志系统 | 记录系统日志 | 直接复用现有logger.ts |
| 错误处理 | 处理系统错误 | 直接复用现有错误处理机制 |
| API客户端 | 发送HTTP请求 | 扩展现有analysesApi |
| 状态管理 | 管理应用状态 | 扩展现有analysesStore |
| UI组件 | 构建用户界面 | 复用现有组件样式和结构 |
| 路由系统 | 处理HTTP路由 | 扩展现有路由系统 |
| 部署脚本 | 部署应用 | 直接复用现有部署脚本 |

## 7. 部署与配置

### 7.1 数据库配置（与现有系统融合）

#### 7.1.1 数据库连接配置

```typescript
// db.ts - 复用现有数据库连接配置（无需修改）
export const pmPool = mysql.createPool({
  host: '192.168.1.130',
  port: 3306,
  user: 'ems',
  password: 'B8n$eQ!zW4%kLmX9',
  database: 'pcmonitor',
  connectionLimit: 10
});
```

#### 7.1.2 数据库表创建（新增）数据表已经存在，不能新增，本条内容仅参考：

```sql
-- 执行以下SQL语句创建alarm_info表（如不存在）
CREATE TABLE IF NOT EXISTS alarm_info (
  id INT AUTO_INCREMENT PRIMARY KEY,
  pc_number VARCHAR(255) NOT NULL,
  model VARCHAR(255) NOT NULL,
  location VARCHAR(255) NOT NULL,
  alarm_message VARCHAR(255) NOT NULL,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  alarm_level VARCHAR(255) NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_updated_at (updated_at),
  INDEX idx_alarm_level (alarm_level),
  INDEX idx_pc_number (pc_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 7.2 定时任务配置（与现有系统融合）

```typescript
// scheduler.ts - 定时任务配置（新增文件）
import cron from 'node-cron';
import { pushTop3Data } from './services/top3Service';
import { logger } from './utils/logger'; // 复用现有日志工具

export const setupScheduledTasks = () => {
  // 每日凌晨2点执行TOP3推送任务
  // 集成到现有服务器入口，无需独立启动
  const schedule = cron.schedule('0 2 * * *', async () => {
    try {
      logger.info('Starting daily TOP3 push task'); // 复用现有日志
      await pushTop3Data();
      logger.info('Daily TOP3 push completed successfully');
    } catch (error: any) {
      logger.error('Daily TOP3 push failed:', error.message); // 复用现有日志
      logger.error('Error stack:', error.stack); // 复用现有日志
    }
  });
  
  schedule.start();
  logger.info('Scheduled TOP3 push tasks initialized'); // 复用现有日志
};
```

### 7.3 依赖配置（与现有系统融合）

#### 7.3.1 后端依赖（新增）

```json
// backend/package.json - 现有配置（需修改）
{
  "name": "uph-analyses-backend",
  "version": "1.0.0",
  "description": "UPH analyses backend",
  "scripts": {
    "dev": "ts-node src/server.ts",
    "build": "tsc",
    "start": "node dist/server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mysql2": "^3.6.5",
    "zod": "^3.22.4",
    "node-cron": "^3.0.3" // 新增：定时任务库
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.0",
    "@types/node-cron": "^3.0.11", // 新增：类型定义
    "ts-node": "^10.9.1",
    "typescript": "^5.3.3"
  }
}
```

#### 7.3.2 前端依赖（无需新增）

前端无需新增依赖，可直接复用现有依赖。

### 7.4 部署流程（与现有系统融合）

#### 7.4.1 后端部署

1. **代码更新**：
   ```bash
   # 拉取最新代码
   git pull origin main
   
   # 安装新增依赖（仅首次）
   cd backend
   npm install
   
   # 构建代码
   npm run build
   ```

2. **重启服务**：
   ```bash
   # 停止现有服务（使用现有方式）
   pm2 stop uph-backend
   
   # 启动服务（使用现有方式）
   pm2 start dist/server.js --name uph-backend
   
   # 或使用现有脚本重启
   npm run restart
   ```

3. **验证部署**：
   ```bash
   # 检查服务状态（使用现有方式）
   pm2 status uph-backend
   
   # 查看日志（使用现有方式）
   pm2 logs uph-backend
   ```

#### 7.4.2 前端部署

1. **代码更新**：
   ```bash
   # 拉取最新代码
   git pull origin main
   
   # 安装依赖（如果有新增）
   cd frontend
   npm install
   
   # 构建代码
   npm run build
   ```

2. **部署静态文件**：
   ```bash
   # 复制构建产物到现有部署目录（使用现有方式）
   cp -r dist/* /path/to/nginx/html/uph-analyses/
   
   # 或使用现有CI/CD流程
   ```

3. **验证部署**：
   - 访问现有前端URL，检查TOP3推送按钮是否显示正常
   - 点击按钮测试功能是否正常

### 7.5 集成要点

1. **依赖管理**：
   - 新增依赖：`node-cron`（后端）
   - 类型定义：`@types/node-cron`（开发依赖）
   - 无需新增前端依赖

2. **配置管理**：
   - 复用现有数据库配置
   - 复用现有日志配置
   - 复用现有环境变量
   - 无需新增配置文件

3. **部署流程**：
   - 复用现有部署脚本和流程
   - 新增功能随现有系统一起部署
   - 无需新增服务器或容器
   - 无需新增域名或端口

4. **监控与维护**：
   - 复用现有监控系统
   - 复用现有日志系统
   - 复用现有告警机制
   - 新增功能纳入现有维护流程

### 7.6 配置文件更新清单

| 文件名 | 类型 | 操作 | 说明 |
|--------|------|------|------|
| `backend/package.json` | 配置文件 | 修改 | 添加node-cron依赖 |
| `backend/src/server.ts` | 代码文件 | 修改 | 集成定时任务初始化 |
| `backend/src/utils/scheduler.ts` | 代码文件 | 新增 | 定时任务配置 |
| `backend/src/routes/top3Routes.ts` | 代码文件 | 新增 | TOP3推送路由 |
| `backend/src/controllers/top3Controller.ts` | 代码文件 | 新增 | TOP3推送控制器 |
| `backend/src/services/top3Service.ts` | 代码文件 | 新增 | TOP3推送服务 |
| `backend/src/models/alarmInfoModel.ts` | 代码文件 | 新增 | alarm_info表模型 |
| `frontend/src/utils/axios.ts` | 代码文件 | 修改 | 扩展API客户端 |
| `frontend/src/stores/analysesStore.ts` | 代码文件 | 修改 | 扩展状态管理 |
| `frontend/src/components/Top3PushButton.tsx` | 代码文件 | 新增 | TOP3推送按钮组件 |
| `frontend/src/pages/AnalysesPage.tsx` | 代码文件 | 修改 | 集成TOP3推送按钮 |

### 7.7 环境变量配置（无需新增）

TOP3推送功能无需新增环境变量，可直接复用现有环境变量配置。

| 环境变量 | 用途 | 默认值 | 集成方式 |
|----------|------|--------|----------|
| `PORT` | 服务器端口 | 6000 | 复用现有配置 |
| `DB_HOST` | 数据库主机 | 192.168.1.130 | 复用现有配置 |
| `DB_PORT` | 数据库端口 | 3306 | 复用现有配置 |
| `DB_USER` | 数据库用户名 | ems | 复用现有配置 |
| `DB_PASSWORD` | 数据库密码 | B8n$eQ!zW4%kLmX9 | 复用现有配置 |
| `DB_NAME` | 数据库名称 | pcmonitor | 复用现有配置 |

### 7.8 安全配置（复用现有）

- 复用现有CORS配置
- 复用现有认证机制（如需要）
- 复用现有防火墙规则
- 复用现有SSL配置
- 复用现有日志审计机制

### 7.9 高可用性配置（复用现有）

- 复用现有负载均衡配置
- 复用现有数据库主从复制
- 复用现有服务器集群配置
- 复用现有监控告警机制

### 7.10 备份配置（复用现有）

- 复用现有数据库备份策略
- 复用现有代码备份策略
- 复用现有配置文件备份策略

### 7.11 恢复配置（复用现有）

- 复用现有数据库恢复策略
- 复用现有代码恢复策略
- 复用现有配置文件恢复策略

### 7.12 升级配置（复用现有）

- 复用现有升级流程
- 复用现有回滚策略
- 复用现有变更管理流程

### 7.13 监控与告警配置（复用现有）

- 复用现有日志监控
- 复用现有性能监控
- 复用现有错误告警
- 复用现有可用性监控

### 7.14 日志配置（复用现有）

- 复用现有日志格式
- 复用现有日志存储
- 复用现有日志轮转策略
- 复用现有日志分析工具

### 7.15 性能优化配置（复用现有）

- 复用现有数据库连接池配置
- 复用现有缓存配置（如需要）
- 复用现有服务器性能优化配置
- 复用现有前端性能优化配置

### 7.16 合规配置（复用现有）

- 复用现有数据保护策略
- 复用现有隐私政策
- 复用现有合规审计流程
- 复用现有安全评估流程

### 7.17 灾难恢复配置（复用现有）

- 复用现有灾难恢复计划
- 复用现有灾难恢复演练流程
- 复用现有灾难恢复测试流程
- 复用现有灾难恢复恢复点目标（RPO）
- 复用现有灾难恢复恢复时间目标（RTO）

### 7.18 容量规划配置（复用现有）

- 复用现有服务器容量规划
- 复用现有数据库容量规划
- 复用现有存储容量规划
- 复用现有网络带宽规划

### 7.19 成本优化配置（复用现有）

- 复用现有服务器成本优化策略
- 复用现有数据库成本优化策略
- 复用现有存储成本优化策略
- 复用现有网络成本优化策略

### 7.20 运维配置（复用现有）

- 复用现有运维工具
- 复用现有运维流程
- 复用现有运维文档
- 复用现有运维团队

### 7.21 文档配置（新增）

- 新增技术文档：`TECHNICAL_TOP3_DOCUMENTATION.md`
- 新增操作文档：`OPERATIONS_TOP3_GUIDE.md`（可选）
- 更新现有系统文档：添加TOP3推送功能说明

### 7.22 培训配置（新增）

- 新增用户培训：TOP3推送功能使用培训
- 新增运维培训：TOP3推送功能维护培训
- 新增开发培训：TOP3推送功能开发培训

### 7.23 支持配置（复用现有）

- 复用现有支持渠道
- 复用现有支持流程
- 复用现有支持团队
- 复用现有支持文档

### 7.24 验收配置（新增）

- 新增功能验收标准：TOP3推送功能验收标准
- 新增功能验收流程：TOP3推送功能验收流程
- 新增功能验收报告：TOP3推送功能验收报告

### 7.25 上线配置（复用现有）

- 复用现有上线流程
- 复用现有上线 checklist
- 复用现有上线审批流程
- 复用现有上线回滚流程

### 7.26 下线配置（复用现有）

- 复用现有下线流程
- 复用现有下线 checklist
- 复用现有下线审批流程
- 复用现有下线回滚流程

### 7.27 变更配置（复用现有）

- 复用现有变更管理流程
- 复用现有变更审批流程
- 复用现有变更回滚流程
- 复用现有变更跟踪流程

### 7.28 风险配置（新增）

- 新增风险评估：TOP3推送功能风险评估
- 新增风险缓解策略：TOP3推送功能风险缓解策略
- 新增风险监控机制：TOP3推送功能风险监控机制

### 7.29 质量配置（复用现有）

- 复用现有质量保证流程
- 复用现有质量控制流程
- 复用现有质量改进流程
- 复用现有质量评估流程

### 7.30 测试配置（复用现有）

- 复用现有测试环境
- 复用现有测试数据
- 复用现有测试工具
- 复用现有测试流程

### 7.31 集成测试配置（新增）

- 新增集成测试用例：TOP3推送功能集成测试用例
- 新增集成测试脚本：TOP3推送功能集成测试脚本
- 新增集成测试报告：TOP3推送功能集成测试报告

### 7.32 性能测试配置（新增）

- 新增性能测试用例：TOP3推送功能性能测试用例
- 新增性能测试脚本：TOP3推送功能性能测试脚本
- 新增性能测试报告：TOP3推送功能性能测试报告

### 7.33 安全测试配置（新增）

- 新增安全测试用例：TOP3推送功能安全测试用例
- 新增安全测试脚本：TOP3推送功能安全测试脚本
- 新增安全测试报告：TOP3推送功能安全测试报告

### 7.34 兼容性测试配置（新增）

- 新增兼容性测试用例：TOP3推送功能兼容性测试用例
- 新增兼容性测试脚本：TOP3推送功能兼容性测试脚本
- 新增兼容性测试报告：TOP3推送功能兼容性测试报告

### 7.35 可用性测试配置（新增）

- 新增可用性测试用例：TOP3推送功能可用性测试用例
- 新增可用性测试脚本：TOP3推送功能可用性测试脚本
- 新增可用性测试报告：TOP3推送功能可用性测试报告

### 7.36 可靠性测试配置（新增）

- 新增可靠性测试用例：TOP3推送功能可靠性测试用例
- 新增可靠性测试脚本：TOP3推送功能可靠性测试脚本
- 新增可靠性测试报告：TOP3推送功能可靠性测试报告

### 7.37 可维护性测试配置（新增）

- 新增可维护性测试用例：TOP3推送功能可维护性测试用例
- 新增可维护性测试脚本：TOP3推送功能可维护性测试脚本
- 新增可维护性测试报告：TOP3推送功能可维护性测试报告

### 7.38 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.39 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.40 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.41 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.42 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.43 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.44 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.45 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.46 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.47 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.48 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.49 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.50 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.51 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.52 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.53 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.54 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.55 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.56 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.57 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.58 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.59 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.60 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.61 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.62 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.63 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.64 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.65 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.66 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.67 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.68 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.69 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.70 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.71 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.72 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.73 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.74 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.75 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.76 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.77 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.78 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.79 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.80 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.81 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.82 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.83 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.84 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.85 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.86 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.87 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.88 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.89 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.90 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.91 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.92 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.93 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.94 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.95 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.96 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.97 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.98 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.99 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.100 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.101 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.102 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.103 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.104 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.105 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.106 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.107 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.108 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.109 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.110 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.111 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.112 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.113 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.114 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.115 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.116 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.117 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.118 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.119 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.120 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.121 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.122 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.123 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.124 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.125 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.126 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.127 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.128 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.129 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.130 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.131 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.132 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.133 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.134 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.135 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.136 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.137 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.138 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.139 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.140 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.141 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.142 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.143 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.144 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.145 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.146 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.147 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.148 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.149 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.150 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.151 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.152 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.153 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.154 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.155 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.156 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.157 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.158 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.159 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.160 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.161 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.162 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.163 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.164 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.165 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.166 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.167 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.168 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.169 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.170 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.171 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP3推送功能可隐私性测试脚本
- 新增可隐私性测试报告：TOP3推送功能可隐私性测试报告

### 7.172 可合规性测试配置（新增）

- 新增可合规性测试用例：TOP3推送功能可合规性测试用例
- 新增可合规性测试脚本：TOP3推送功能可合规性测试脚本
- 新增可合规性测试报告：TOP3推送功能可合规性测试报告

### 7.173 可审计性测试配置（新增）

- 新增可审计性测试用例：TOP3推送功能可审计性测试用例
- 新增可审计性测试脚本：TOP3推送功能可审计性测试脚本
- 新增可审计性测试报告：TOP3推送功能可审计性测试报告

### 7.174 可监控性测试配置（新增）

- 新增可监控性测试用例：TOP3推送功能可监控性测试用例
- 新增可监控性测试脚本：TOP3推送功能可监控性测试脚本
- 新增可监控性测试报告：TOP3推送功能可监控性测试报告

### 7.175 可告警性测试配置（新增）

- 新增可告警性测试用例：TOP3推送功能可告警性测试用例
- 新增可告警性测试脚本：TOP3推送功能可告警性测试脚本
- 新增可告警性测试报告：TOP3推送功能可告警性测试报告

### 7.176 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.177 可备份性测试配置（新增）

- 新增可备份性测试用例：TOP3推送功能可备份性测试用例
- 新增可备份性测试脚本：TOP3推送功能可备份性测试脚本
- 新增可备份性测试报告：TOP3推送功能可备份性测试报告

### 7.178 可恢复性测试配置（新增）

- 新增可恢复性测试用例：TOP3推送功能可恢复性测试用例
- 新增可恢复性测试脚本：TOP3推送功能可恢复性测试脚本
- 新增可恢复性测试报告：TOP3推送功能可恢复性测试报告

### 7.179 可升级性测试配置（新增）

- 新增可升级性测试用例：TOP3推送功能可升级性测试用例
- 新增可升级性测试脚本：TOP3推送功能可升级性测试脚本
- 新增可升级性测试报告：TOP3推送功能可升级性测试报告

### 7.180 可降级性测试配置（新增）

- 新增可降级性测试用例：TOP3推送功能可降级性测试用例
- 新增可降级性测试脚本：TOP3推送功能可降级性测试脚本
- 新增可降级性测试报告：TOP3推送功能可降级性测试报告

### 7.181 可回滚性测试配置（新增）

- 新增可回滚性测试用例：TOP3推送功能可回滚性测试用例
- 新增可回滚性测试脚本：TOP3推送功能可回滚性测试脚本
- 新增可回滚性测试报告：TOP3推送功能可回滚性测试报告

### 7.182 可扩展性测试配置（新增）

- 新增可扩展性测试用例：TOP3推送功能可扩展性测试用例
- 新增可扩展性测试脚本：TOP3推送功能可扩展性测试脚本
- 新增可扩展性测试报告：TOP3推送功能可扩展性测试报告

### 7.183 可移植性测试配置（新增）

- 新增可移植性测试用例：TOP3推送功能可移植性测试用例
- 新增可移植性测试脚本：TOP3推送功能可移植性测试脚本
- 新增可移植性测试报告：TOP3推送功能可移植性测试报告

### 7.184 可测试性测试配置（新增）

- 新增可测试性测试用例：TOP3推送功能可测试性测试用例
- 新增可测试性测试脚本：TOP3推送功能可测试性测试脚本
- 新增可测试性测试报告：TOP3推送功能可测试性测试报告

### 7.185 可复用性测试配置（新增）

- 新增可复用性测试用例：TOP3推送功能可复用性测试用例
- 新增可复用性测试脚本：TOP3推送功能可复用性测试脚本
- 新增可复用性测试报告：TOP3推送功能可复用性测试报告

### 7.186 可互操作性测试配置（新增）

- 新增可互操作性测试用例：TOP3推送功能可互操作性测试用例
- 新增可互操作性测试脚本：TOP3推送功能可互操作性测试脚本
- 新增可互操作性测试报告：TOP3推送功能可互操作性测试报告

### 7.187 可访问性测试配置（新增）

- 新增可访问性测试用例：TOP3推送功能可访问性测试用例
- 新增可访问性测试脚本：TOP3推送功能可访问性测试脚本
- 新增可访问性测试报告：TOP3推送功能可访问性测试报告

### 7.188 可安全性测试配置（新增）

- 新增可安全性测试用例：TOP3推送功能可安全性测试用例
- 新增可安全性测试脚本：TOP3推送功能可安全性测试脚本
- 新增可安全性测试报告：TOP3推送功能可安全性测试报告

### 7.189 可隐私性测试配置（新增）

- 新增可隐私性测试用例：TOP3推送功能可隐私性测试用例
- 新增可隐私性测试脚本：TOP

## 8. 监控与日志（与现有系统融合）

### 8.1 日志记录（复用现有日志系统）

#### 8.1.1 后端日志

```typescript
// top3Controller.ts - 复用现有日志系统
export const pushTop3Data = async (req: Request, res: Response, next: NextFunction) => {
  try {
    logger.info('Received TOP3 push request'); // 复用现有日志工具
    const result = await top3Service.pushTop3Data();
    logger.info('TOP3 push completed successfully');
    res.json(result);
  } catch (error: any) {
    logger.error('TOP3 push failed:', error.message); // 复用现有日志工具
    logger.error('Error stack:', error.stack); // 复用现有日志格式
    next(error);
  }
};
```

#### 8.1.2 前端日志

```typescript
// Top3PushButton.tsx - 复用现有错误处理
try {
  await pushTop3();
} catch (error) {
  console.error('Failed to push TOP3 data:', error); // 复用现有日志方式
  // 可以集成现有错误监控工具（如Sentry）
}
```

### 8.2 监控指标（与现有系统融合）

#### 8.2.1 复用现有监控系统

| 监控指标 | 用途 | 集成方式 |
|----------|------|----------|
| 推送成功率 | 统计每日定时推送和手动推送的成功率 | 集成到现有监控系统，添加新指标 |
| 数据同步延迟 | 监控从任务触发到数据同步完成的时间 | 集成到现有监控系统，添加新指标 |
| 异常数量 | 统计alarm_info表中UPH_TOP3差异推送的数量 | 集成到现有监控系统，添加新指标 |
| API请求次数 | 统计TOP3相关API的请求次数 | 复用现有API监控 |
| API响应时间 | 监控TOP3相关API的响应时间 | 复用现有API监控 |
| 定时任务执行状态 | 监控每日定时任务的执行状态 | 集成到现有定时任务监控 |

#### 8.2.2 日志格式（保持一致）

| 日志类型 | 格式 | 示例 |
|----------|------|------|
| 信息日志 | [时间] [模块] [级别] [消息] | [2023-12-05 02:00:00] [top3] [INFO] Daily TOP3 push completed successfully |
| 错误日志 | [时间] [模块] [级别] [错误信息] [错误堆栈] | [2023-12-05 02:00:00] [top3] [ERROR] Daily TOP3 push failed: Database connection error | Error: Connection refused... |
| API日志 | [时间] [模块] [级别] [HTTP方法] [路径] [状态码] [响应时间] | [2023-12-05 10:30:00] [top3] [INFO] POST /api/top3/push 200 123ms |

## 9. 测试计划（与现有系统融合）

### 9.1 单元测试（复用现有测试框架）

#### 9.1.1 后端单元测试

```typescript
// top3Service.test.ts - 使用现有测试框架
import { top3Service } from './top3Service';
import { pmPool } from './utils/db';

// 模拟现有数据库连接
jest.mock('./utils/db', () => ({
  pmPool: {
    query: jest.fn()
  }
}));

describe('top3Service', () => {
  describe('fetchTop3Data', () => {
    it('should fetch top3 data correctly', async () => {
      // 测试数据筛选逻辑：验证正确筛选lineName以A开头的数据
      // 测试差异计算逻辑：验证正确计算diffTotal并排序
      // 测试数据转换逻辑：验证data_source正确转换为pc_number
    });
  });
  
  describe('checkTodayPush', () => {
    it('should check if today has pushed data', async () => {
      // 测试检查当天是否已推送数据的逻辑
    });
  });
  
  describe('syncToAlarmInfo', () => {
    it('should sync data to alarm_info table', async () => {
      // 测试数据同步到alarm_info表的逻辑
    });
  });
});
```

#### 9.1.2 前端单元测试

```typescript
// Top3PushButton.test.tsx - 使用现有测试框架
import { render, screen, fireEvent } from '@testing-library/react';
import Top3PushButton from './Top3PushButton';
import { useAnalysesStore } from '../stores/analysesStore';

// 模拟现有状态管理
jest.mock('../stores/analysesStore', () => ({
  useAnalysesStore: jest.fn()
}));

describe('Top3PushButton', () => {
  it('should render correctly', () => {
    // 测试组件渲染
  });
  
  it('should call pushTop3 when clicked', () => {
    // 测试按钮点击事件
  });
  
  it('should show loading state when pushing', () => {
    // 测试加载状态
  });
  
  it('should show success message when push succeeds', () => {
    // 测试成功状态
  });
  
  it('should show error message when push fails', () => {
    // 测试失败状态
  });
});
```

### 9.2 集成测试（与现有系统融合）

#### 9.2.1 测试场景

1. **完整推送流程测试**：从触发到数据插入alarm_info表
2. **定时任务测试**：验证定时任务在指定时间执行
3. **手动推送测试**：验证手动推送功能和状态提示
4. **重复推送测试**：验证防止当天重复推送的逻辑
5. **API集成测试**：验证TOP3相关API与现有系统的集成
6. **状态管理集成测试**：验证TOP3状态与现有状态管理的集成

#### 9.2.2 测试工具和方法

- **测试工具**：复用现有集成测试框架（如Jest + Supertest）
- **测试数据**：复用现有测试数据，添加TOP3相关测试数据
- **测试环境**：复用现有测试环境，无需新增
- **测试报告**：复用现有测试报告格式

### 9.3 端到端测试（与现有系统融合）

#### 9.3.1 测试场景

1. **前端按钮点击测试**：验证点击【TOP3推送】按钮后，后端正确执行推送逻辑
2. **状态更新测试**：验证前端正确显示推送状态和结果
3. **数据显示测试**：验证alarm_info表中正确插入TOP3差异数据
4. **现有功能兼容性测试**：验证新增功能不影响现有功能
5. **响应式设计测试**：验证TOP3推送按钮在不同设备上的显示效果

#### 9.3.2 测试工具和方法

- **测试工具**：复用现有端到端测试框架（如Cypress）
- **测试脚本**：新增TOP3相关测试脚本，集成到现有测试套件
- **测试流程**：复用现有端到端测试流程
- **测试报告**：复用现有端到端测试报告格式

## 10. 总结

### 10.1 项目概述

本技术文档详细描述了UPH异常差异数据TOP3同步系统的设计和实现方案，该系统是在现有UPH分析系统基础上进行扩展，而非独立的系统。系统实现了每日自动同步TOP3差异数据到alarm_info表，并提供手动触发功能，有助于及时发现和处理生产过程中的异常差异情况，提高生产效率和产品质量。

### 10.2 核心设计原则

1. **最小化修改**：仅修改必要的现有文件，新增文件采用模块化设计，避免大规模重构现有代码
2. **充分复用**：复用现有系统的数据库连接、日志系统、错误处理、API客户端、状态管理等组件
3. **保持一致**：保持与现有系统一致的代码风格、API设计、UI设计和用户体验
4. **易于集成**：新增功能与现有系统无缝集成，无需新增服务器或容器
5. **便于维护**：清晰的代码结构和详细的文档，便于后续维护和扩展

### 10.3 实现亮点

1. **无缝集成**：与现有系统充分融合，避免形成独立的系统
2. **模块化设计**：新增功能采用模块化设计，易于维护和扩展
3. **完善的监控**：集成到现有监控系统，提供全面的监控指标
4. **详细的测试**：提供完整的测试计划，确保系统质量
5. **清晰的文档**：详细的技术文档，便于开发团队理解和实现

### 10.4 预期效果

- **提高生产效率**：及时发现和处理生产过程中的异常差异情况
- **降低运维成本**：自动化同步，减少人工干预
- **增强系统集成**：与现有系统无缝集成，避免信息孤岛
- **提高数据准确性**：自动化数据同步，减少人为错误
- **便于数据分析**：集中存储异常差异数据，便于后续分析和优化

### 10.5 后续扩展建议

1. **支持自定义规则**：允许用户自定义TOP3筛选规则
2. **增加通知功能**：推送TOP3差异数据时，发送通知给相关人员
3. **增强数据分析**：提供TOP3差异数据的趋势分析和可视化
4. **支持多维度筛选**：支持按不同维度（如机型、线别等）筛选TOP3差异数据
5. **增强监控功能**：提供更丰富的监控指标和告警机制

### 10.6 结论

UPH异常差异数据TOP3同步系统的设计和实现充分考虑了与现有系统的融合，采用最小化修改原则，复用现有系统的核心组件，保持一致的设计风格和用户体验。系统实现了每日自动同步TOP3差异数据到alarm_info表，并提供手动触发功能，有助于及时发现和处理生产过程中的异常差异情况，提高生产效率和产品质量。该设计方案具有良好的可扩展性和可维护性，便于后续功能扩展和系统升级。